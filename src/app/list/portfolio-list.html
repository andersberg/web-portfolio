<link rel="import" href="../../assets/libs/polymer/polymer.html">
<link rel="import" href="../post/portfolio-post.html">

<dom-module id="portfolio-list">

  <template>

    <style>

      :host {
          display: flex;
      }

      .list-item > * {
        pointer-events: none;
        user-select: none;
      }
    </style>

  <app-route route="[[route]]" pattern="/:category" data="{{router}}"></app-route>
  <iron-ajax auto url="[[categoryRequest]]" handle-as="json" on-response="handleResponse" debounce-duration="300"></iron-ajax>


  <template is="dom-repeat" items="[[categoryContent.content]]">
    <div class="list-item" on-tap="handleTap" data-id$="[[item.slug]]">
      <p>[[item.projectName]]</p>
      <p>[[item.id]]</p>
      <img src="[[item.thumbnail.src]]" alt="[[item.thumbnail.altText]]">
    </div>
  </template>

  <portfolio-post post="[[selectedPost]]" visible></portfolio-post>

  </template>

  <script>

    Polymer({

      is: 'portfolio-list',

      behaviors: [

      ],

      properties: {
        category: {
          type: String,
          value: () => { return ``; },
        },
        categoryRequest: {
          type: String,
          computed: `computeRequestURL(category)`,
        },
        categoryContent: {
          type: Object,
          value: () => { return {}; },
        },
        selectedPost: {
          type: String,
          value: () => { return ``; },
        }
      },

      observers: [
        'observerRouterPage(router)',
      ],

      ready() {

      },

      attached() {

      },

      detached() {

      },

      /* FUNCTIONS */
      observerRouterPage(router) {
        this.set(`category`, router.category);
        console.log(this.category);
      },

      computeRequestURL(category) {
        return `../../assets/data/${category}.json`;
      },

      handleResponse(data) {
        this.set(`categoryContent`, data.detail.response);
        console.log(this.categoryContent);
      },

      handleTap(event) {
        this.set(`selectedPost`, event.target.dataset.id)
        console.log(this.selectedPost);
      },

    });

  </script>

</dom-module>