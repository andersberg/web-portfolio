<link rel="import" href="../../assets/libs/polymer/polymer.html">
<link rel="import" href="../../assets/libs/app-route/app-route.html">
<link rel="import" href="../../assets/libs/iron-ajax/iron-ajax.html">

<dom-module id="portfolio-post">

  <template>

    <style>

      :host {
          display: flex;
      }

      :host:not([visible]) {
          display: none !important;
      }

    </style>

  <!--<app-route route="[[route]]" pattern="/:post" data="{{router}}"></app-route>-->
  <iron-ajax id="post-request" url="[[requestUrl]]" handle-as="json" on-response="onResponse" debounce-duration="300"></iron-ajax>
    [[postContent.projectName]]

    <template is="dom-repeat" items="[[postContent.images]]">
      <img src="[[item]]" alt="">
    </template>

  </template>

  <script>

    Polymer({

      is: 'portfolio-post',

      behaviors: [

      ],

      properties: {
        category: {
          type: String,
          value: () => { return ``; },
        },
        post: {
          type: String,
          value: () => { return ``; },
        },
        requestUrl: {
          type: String,
          value: () => { return ``; },
          computed: `computeRequestURL(category, post)`,
        },
        categoryContent: {
          type: Object,
          value: () => { return {}; },
        },
        postContent: {
          type: Object,
          value: () => { return {}; },
        },
      },

      observers: [
        'observerRouter(router)',
        'observerCategory(category)',
        'observerPost(post)',
        'observerRequestUrl(requestUrl)',
      ],

      ready() {

      },

      attached() {

      },

      detached() {

      },

      /* OBSERVERS */
      // observerRouter(router) {

      // },
      observerCategory(category) {
        // console.log(`observerCategory: `, typeof this.category, this.category);
      },

      observerPost(post) {
        // console.log(`observerPost: `, typeof this.post, this.post);
      },

      observerRequestUrl(requestUrl) {
        // console.log(`observerRequestUrl: `, requestUrl);
        if (requestUrl) this.doRequest();
      },

      /* FUNCTIONS */
      computeRequestURL(category, post) {
        if (category && post) return `../../assets/data/${category}.json`;
      },

      doRequest() {
        this.$$(`#post-request`).generateRequest();
      },

      onResponse(data) {
        this.set(`categoryContent`, data.detail.response);
        this.getPost(this.categoryContent);
      },

      getPost(categoryContent) {
        for (let i in categoryContent.content) {
          if (categoryContent.content[i].id === this.post) this.set(`postContent`, categoryContent.content[i]);
        }
      },

    });

  </script>

</dom-module>